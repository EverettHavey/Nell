<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu: Items & Checkout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general layout */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            padding-top: 64px; /* Space for the fixed header */
        }
        
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #1f2937; /* Dark gray background */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 500;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fcd34d; /* Amber-300 */
            text-decoration: none;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .item-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .item-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .back-button {
            transition: background-color 0.2s, color 0.2s;
        }
        .back-button:hover {
            background-color: #fcd34d; /* Amber-300 */
            color: #1f2937;
        }

        /* Cart/Checkout styles */
        .order-modal {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }
        
        .payment-option-card {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .payment-option-card:hover {
            border-color: #93c5fd; /* Blue-300 */
        }
        .payment-option-card.selected {
            border-color: #1e40af; /* Blue-700 */
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.3);
            background-color: #eff6ff; /* Blue-50 */
        }

        /* Spinner for driver matching */
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #1e40af; 
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <script>
        // --- DATA SETUP ---
        const ALL_RESTAURANTS = [
            { name: 'Starbucks', category: 'Fast Food', color: '00704A' }, { name: 'McDonalds', category: 'Fast Food', color: 'FFC72C' },
            { name: 'The Grill Hub', category: 'Burgers', color: '333333' }, { name: 'Fresh Fries', category: 'Fast Food', color: '8B4513' },
            { name: 'Nell Grocers', category: 'Grocery', color: '4CAF50' }, { name: 'Wok Around The Clock', category: 'Asian', color: 'A0522D' },
            { name: 'Artisan Pizza Co.', category: 'Pizza', color: 'ff5a5f' }, { name: 'Taqueria del Sol', category: 'Mexican', color: '007bff' },
            { name: 'Juice Bar Express', category: 'Health', color: '06B6D4' }, { name: 'Italian Trattoria', category: 'Italian', color: 'DC2626' },
            { name: 'Doughnut Delight', category: 'Dessert', color: 'F9A8D4' }, { name: 'Sushi Samurai', category: 'Asian', color: '1F2937' },
            { name: 'Burger King', category: 'Fast Food', color: 'DC2626' }, { name: 'KFC', category: 'Fast Food', color: '991B1F' },
            { name: 'Chipotle', category: 'Mexican', color: '6A0808' }, { name: 'Five Guys', category: 'Burgers', color: 'E3000E' },
            { name: 'Subway', category: 'Health', color: '008C36' }, { name: 'Taco Bell', category: 'Fast Food', color: '581C87' },
            { name: 'Panda Express', category: 'Asian', color: 'D97706' }, { name: 'Domino\'s', category: 'Pizza', color: '006491' },
            { name: 'Saffron Spice', category: 'Indian', color: 'FF9933' }, { name: 'Cheesecake Factory', category: 'Dessert', color: '6B21A8' },
            { name: 'Seafood Shack', category: 'Seafood', color: '10B981' }, { name: 'The Vegan Spot', category: 'Health', color: '10B981' },
            { name: 'Dunkin\'', category: 'Fast Food', color: 'E91E63' }, { name: 'Fresh Bagel Bakery', category: 'Bakery', color: '78350F' },
            { name: 'Mediterranean Feast', category: 'Mediterranean', color: '3B82F6' }, { name: 'Pho Saigon', category: 'Asian', color: '581C87' },
            { name: 'Ice Cream Dream', category: 'Dessert', color: 'FBBF24' }
        ];
        
        const DELIVERY_DRIVERS = [
            { name: 'Chloe K.', vehicle: 'Scooter (Red)', license: '789-ABC', eta: '25-30 min', rating: 4.9 },
            { name: 'Jordan P.', vehicle: 'Toyota Prius', license: '123-XYZ', eta: '30-35 min', rating: 4.7 },
            { name: 'Sam M.', vehicle: 'Electric Bike', license: 'BKE-456', eta: '20-25 min', rating: 4.8 },
            { name: 'Lee H.', vehicle: 'Ford Focus', license: 'FOC-007', eta: '35-40 min', rating: 4.6 },
        ];


        // --- GLOBAL STATE ---
        let cart = [];
        let restaurantColor = '1e40af'; 
        let currentRestaurantName = '';
        let selectedPaymentMethod = 'credit';
        let deliveryState = 'cart'; // States: 'cart', 'payment', 'driver_matching', 'confirmed'
        let currentDriver = null;
        let orderTotals = { subtotal: 0, deliveryFee: 5.00, tax: 0, finalTotal: 0 };


        // --- CART/ORDER MANAGEMENT FUNCTIONS ---

        const calculateTotals = () => {
            orderTotals.subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            orderTotals.tax = orderTotals.subtotal * 0.08; // Placeholder 8% tax
            orderTotals.finalTotal = orderTotals.subtotal + orderTotals.deliveryFee + orderTotals.tax;
        };

        const updateCartUI = () => {
            calculateTotals();
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            // Update header summary
            document.getElementById('cartSummary').innerHTML = `
                <button onclick="toggleOrderModal(true, 'cart')" class="bg-amber-300 text-gray-800 px-4 py-2 rounded-lg font-bold hover:bg-amber-400 transition duration-150 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M3 1a1 1 0 000 2h1.22l.305 1.25H16.74a1 1 0 00.745-.391l2.5-3.25a1 1 0 00-.083-1.268l-.013-.005A1 1 0 0017.07 1H3zM7 16a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" />
                    </svg>
                    Cart: ${totalItems} items ($${orderTotals.subtotal.toFixed(2)})
                </button>
            `;
            
            // If the modal is open, re-render it
            if (!document.getElementById('orderModal').classList.contains('hidden')) {
                renderModalContent();
            }
        };

        const addToCart = (id, name, price) => {
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ id, name, price, quantity: 1 });
            }
            
            updateCartUI();
            showFeedback(`${name} added!`);
        };

        const updateQuantity = (id, delta) => {
            const itemIndex = cart.findIndex(item => item.id === id);
            if (itemIndex > -1) {
                cart[itemIndex].quantity += delta;
                if (cart[itemIndex].quantity <= 0) {
                    cart.splice(itemIndex, 1); // Remove item if quantity hits 0 or less
                }
            }
            updateCartUI();
        };

        // --- UI/Modal Functions ---
        
        const updateDeliveryState = (newState) => {
            deliveryState = newState;
            renderModalContent();
            
            if (newState === 'driver_matching') {
                startMatching();
            }
            
            if (newState === 'confirmed') {
                // Clear the cart only after driver is confirmed
                cart = [];
                updateCartUI();
            }
        };

        const toggleOrderModal = (show, state = 'cart') => {
            document.getElementById('orderModal').classList.toggle('hidden', !show);
            if (show) {
                // Only reset to cart state if we're not currently tracking a confirmed order
                if (deliveryState !== 'confirmed') {
                    updateDeliveryState(state);
                }
                
                // Ensure payment method state is initialized for payment view
                selectPaymentMethod(selectedPaymentMethod); 
            }
        };
        
        const showFeedback = (message) => {
            const feedbackBox = document.getElementById('feedbackBox');
            feedbackBox.textContent = message;
            feedbackBox.classList.remove('hidden', 'opacity-0');
            feedbackBox.classList.add('opacity-100');
            
            setTimeout(() => {
                feedbackBox.classList.remove('opacity-100');
                feedbackBox.classList.add('opacity-0');
                // Hide fully after transition
                setTimeout(() => {
                    feedbackBox.classList.add('hidden');
                }, 300);
            }, 2000);
        };

        const startMatching = () => {
            currentDriver = DELIVERY_DRIVERS[Math.floor(Math.random() * DELIVERY_DRIVERS.length)];
            
            // Simulate driver matching time
            setTimeout(() => {
                updateDeliveryState('confirmed');
            }, 3000); // 3 second delay
        };

        const processPayment = (event) => {
            if (event && event.preventDefault) {
                event.preventDefault(); // Prevent form submission for credit card
            }
            
            if (cart.length === 0) {
                showFeedback('Cart is empty. Please add items.');
                return;
            }
            
            let message = '';
            
            if (selectedPaymentMethod === 'credit') {
                const cardNumber = document.getElementById('cardNumber').value;
                if (!/^\d{16}$/.test(cardNumber)) {
                    // Replaced window.alert with showFeedback
                    showFeedback('Error: Please enter a valid 16-digit card number.'); 
                    return;
                }
                message = `Processing Credit Card payment of $${orderTotals.finalTotal.toFixed(2)}... Success!`;
            } else if (selectedPaymentMethod === 'cash') {
                message = `Order confirmed! Payment of $${orderTotals.finalTotal.toFixed(2)} due cash on arrival.`;
            }
            
            showFeedback(message);
            
            // Proceed to driver matching
            updateDeliveryState('driver_matching');
        };

        const selectPaymentMethod = (method) => {
            selectedPaymentMethod = method;
            document.getElementById('creditOption').classList.remove('selected');
            document.getElementById('cashOption').classList.remove('selected');
            
            document.getElementById(`${method}Option`).classList.add('selected');
            
            // Toggle credit card details form visibility and buttons
            const isCredit = method === 'credit';
            document.getElementById('creditCardForm').classList.toggle('hidden', !isCredit);
            document.getElementById('cashPaymentBtn').classList.toggle('hidden', isCredit);
            
            // Update button text
            const payBtn = document.getElementById('creditCardPayBtn');
            if(payBtn) {
                 payBtn.textContent = `Pay Now $${orderTotals.finalTotal.toFixed(2)}`;
            }
        };
        
        // --- VIEW RENDERING ---

        const renderCartView = (container) => {
            container.innerHTML = `
                <h2 class="text-3xl font-bold mb-6 border-b pb-2 text-gray-800">Your Order</h2>
                
                <div id="cartList" class="divide-y divide-gray-100 min-h-[100px]">
                    ${cart.length === 0 ? 
                        '<p class="text-center text-gray-500 py-4">Your cart is empty.</p>' :
                        cart.map(item => `
                            <div class="flex justify-between items-center py-2 border-b last:border-b-0">
                                <div class="flex-grow">
                                    <p class="font-semibold text-gray-800">${item.name}</p>
                                    <p class="text-sm text-gray-500">$${item.price.toFixed(2)} ea</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="updateQuantity('${item.id}', -1)" class="w-6 h-6 bg-gray-200 rounded-full text-gray-800 hover:bg-gray-300">-</button>
                                    <span class="font-bold w-4 text-center">${item.quantity}</span>
                                    <button onclick="updateQuantity('${item.id}', 1)" class="w-6 h-6 bg-blue-100 rounded-full text-blue-700 hover:bg-blue-200">+</button>
                                </div>
                                <span class="font-bold text-right w-16">$${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        `).join('')
                    }
                </div>

                <!-- Totals -->
                <div class="mt-6 space-y-2 border-t pt-4">
                    <div class="flex justify-between text-gray-600">
                        <span>Subtotal</span>
                        <span id="cartSubtotal" class="font-semibold">$${orderTotals.subtotal.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Delivery Fee</span>
                        <span id="cartDeliveryFee" class="font-semibold">$${orderTotals.deliveryFee.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Tax (8%)</span>
                        <span id="cartTax" class="font-semibold">$${orderTotals.tax.toFixed(2)}</span>
                    </div>
                </div>

                <!-- Total -->
                <div class="flex justify-between text-2xl font-extrabold mt-4 pt-4 border-t border-blue-100">
                    <span>Total</span>
                    <span id="cartTotal" class="text-blue-700">$${orderTotals.finalTotal.toFixed(2)}</span>
                </div>
                
                <!-- Action Buttons: Enhanced for Mobile Responsiveness (Stacking on small screens) -->
                <div class="mt-8 flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:space-x-4">
                    <button onclick="toggleOrderModal(false)" class="w-full sm:w-1/2 py-3 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition duration-150">
                        Continue Shopping
                    </button>
                    <button id="modalCheckoutBtn" onclick="updateDeliveryState('payment')" 
                            class="w-full sm:w-1/2 py-3 bg-blue-700 text-white rounded-lg font-semibold hover:bg-blue-800 transition duration-150 ${cart.length === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${cart.length === 0 ? 'disabled' : ''}>
                        Proceed to Payment
                    </button>
                </div>
            `;
        };

        const renderPaymentView = (container) => {
             container.innerHTML = `
                <h2 class="text-3xl font-bold mb-6 text-blue-700">Select Payment Method</h2>
                
                <div class="space-y-4">
                    <!-- Credit Card Option -->
                    <div id="creditOption" onclick="selectPaymentMethod('credit')" class="payment-option-card p-4 rounded-xl bg-white shadow-sm border-2 border-gray-300">
                        <div class="flex items-center space-x-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" viewBox="0 0 20 20" fill="currentColor"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" /><path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 110-2 1 1 0 010 2zm10-1a1 1 0 100 2h1a1 1 0 100-2h-1z" clip-rule="evenodd" /></svg>
                            <p class="font-semibold text-lg">Credit/Debit Card</p>
                        </div>
                    </div>

                    <!-- Cash on Delivery Option -->
                    <div id="cashOption" onclick="selectPaymentMethod('cash')" class="payment-option-card p-4 rounded-xl bg-white shadow-sm border-2 border-gray-300">
                        <div class="flex items-center space-x-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1h4a1 1 0 011 1v5a1 1 0 01-1 1h-.828l1.768 1.768A1 1 0 0114 15h-4.172l.939-.939A7.001 7.001 0 0013 4a1 1 0 112 0 5.001 5.001 0 01-5 5H4a1 1 0 110-2h6V2zm-2 9a1 1 0 100 2h4a1 1 0 100-2H8z" clip-rule="evenodd" /></svg>
                            <p class="font-semibold text-lg">Cash on Delivery (COD)</p>
                        </div>
                    </div>
                </div>

                <!-- Credit Card Form -->
                <form id="creditCardForm" onsubmit="processPayment(event)" class="mt-8 space-y-4">
                    <h3 class="font-bold text-gray-700">Card Details (Demo Validation)</h3>
                    <input type="text" id="cardNumber" placeholder="Card Number (16 digits)" required pattern="\d{16}" maxlength="16" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <div class="flex space-x-4">
                        <input type="text" id="expiry" placeholder="MM/YY" required pattern="(0[1-9]|1[0-2])\/[0-9]{2}" maxlength="5" class="w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        <input type="text" id="cvc" placeholder="CVC" required pattern="\d{3,4}" maxlength="4" class="w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <input type="text" id="cardName" placeholder="Name on Card" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    
                    <button type="submit" id="creditCardPayBtn" class="w-full py-3 bg-blue-700 text-white font-extrabold rounded-lg hover:bg-blue-800 transition duration-150 mt-6">
                        Pay Now $${orderTotals.finalTotal.toFixed(2)}
                    </button>
                </form>
                
                <!-- Cash Button -->
                   <button type="button" id="cashPaymentBtn" onclick="processPayment()" class="w-full py-3 bg-blue-700 text-white font-extrabold rounded-lg hover:bg-blue-800 transition duration-150 mt-16 hidden">
                    Place Order (Pay Cash $${orderTotals.finalTotal.toFixed(2)} on Delivery)
                </button>


                <button type="button" onclick="updateDeliveryState('cart')" class="w-full py-2 text-blue-700 font-semibold rounded-lg hover:underline transition duration-150 mt-4">
                    &larr; Back to Cart Summary
                </button>
            `;
            // Re-apply selection state after rendering
            selectPaymentMethod(selectedPaymentMethod);
        };
        
        const renderMatchingView = (container) => {
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-center py-20 space-y-6">
                    <div class="spinner"></div>
                    <h2 class="text-3xl font-bold text-gray-800">Assigning Delivery Driver...</h2>
                    <p class="text-gray-500">Please wait, your order is being prepared while we find the fastest driver.</p>
                    
                    <button onclick="toggleOrderModal(false)" class="mt-8 py-2 px-4 text-blue-700 font-semibold hover:underline">
                        Hide Tracker
                    </button>
                </div>
            `;
        };

        const renderConfirmedView = (container) => {
             container.innerHTML = `
                <div class="space-y-6 text-center">
                    <div class="text-6xl mb-4 text-green-500">ðŸš€</div>
                    <h2 class="text-3xl font-bold text-green-600">Order Confirmed!</h2>
                    <p class="text-xl text-gray-700">Your food is on its way!</p>

                    <!-- Driver Card -->
                    <div class="p-6 bg-white rounded-xl shadow-lg border-t-4 border-amber-500 mx-auto max-w-sm">
                        <p class="text-2xl font-extrabold text-gray-800">${currentDriver.name}</p>
                        <p class="text-gray-600">${currentDriver.vehicle} (License: ${currentDriver.license})</p>
                        <p class="text-blue-600 font-bold mt-2">${currentDriver.rating} &#9733; Rating</p>
                        <div class="mt-4 pt-3 border-t">
                             <p class="font-semibold text-lg">Estimated Arrival: <span class="text-red-500">${currentDriver.eta}</span></p>
                             <p class="text-sm text-gray-500">Payment: ${selectedPaymentMethod === 'cash' ? 'Cash on Delivery' : 'Card Paid'}</p>
                        </div>
                    </div>

                    <button onclick="window.location.reload()" class="w-full max-w-xs py-3 bg-blue-700 text-white font-semibold rounded-xl hover:bg-blue-800 transition duration-150 mt-8">
                        Place Another Order
                    </button>
                    <button onclick="toggleOrderModal(false)" class="w-full max-w-xs py-2 text-gray-600 font-semibold rounded-xl hover:underline">
                        Close
                    </button>
                </div>
            `;
        };

        const renderModalContent = () => {
            const container = document.getElementById('modalContentContainer');
            if (!container) return;
            
            // Recalculate totals before rendering any view
            calculateTotals(); 

            switch (deliveryState) {
                case 'cart':
                    renderCartView(container);
                    break;
                case 'payment':
                    renderPaymentView(container);
                    break;
                case 'driver_matching':
                    renderMatchingView(container);
                    break;
                case 'confirmed':
                    renderConfirmedView(container);
                    break;
                default:
                    renderCartView(container);
            }
        };
        
        // --- INITIALIZATION ---
        const generateMenu = (restaurantName, category) => {
             const items = [];
             const bases = {
                'Fast Food': ['Burger', 'Fries', 'Shake', 'Wrap', 'Nuggets'],
                'Burgers': ['Gourmet Burger', 'Classic Cheeseburger', 'Veggie Patty', 'Onion Rings', 'Milkshake'],
                'Asian': ['Noodle Dish', 'Fried Rice', 'Spring Rolls', 'Dim Sum', 'Soup'],
                'Mexican': ['Taco', 'Burrito', 'Quesadilla', 'Nachos', 'Enchilada'],
                'Pizza': ['Pizza Slice', 'Side Dish', 'Garlic Knots', 'Soda', 'Dessert Pizza'],
                'Italian': ['Pasta Dish', 'Lasagna', 'Tiramisu', 'Bruschetta', 'Ravioli'],
                'Dessert': ['Cake Slice', 'Ice Cream Scoop', 'Brownie', 'Milkshake', 'Cookie'],
                'Health': ['Salad Bowl', 'Smoothie', 'Protein Wrap', 'Juice Cleanse', 'Fruit Cup'],
                'Grocery': ['Fresh Bread', 'Milk Carton', 'Dozen Eggs', 'Apples', 'Chicken Breast'],
                'Indian': ['Curry', 'Naan Bread', 'Samosa', 'Rice Pilaf', 'Chai Tea'],
                'Seafood': ['Grilled Salmon', 'Shrimp Scampi', 'Fish Tacos', 'Clam Chowder', 'Fries'],
                'Bakery': ['Croissant', 'Muffin', 'Scone', 'Espresso', 'Loaf of Bread'],
                'Mediterranean': ['Gyro', 'Hummus Plate', 'Falafel Wrap', 'Greek Salad', 'Pita Bread']
            };
            
            const itemBases = bases[category] || ['Specialty Dish', 'Side', 'Drink', 'Dessert', 'Appetizer'];

            for (let i = 1; i <= 15; i++) {
                const baseIndex = (i - 1) % itemBases.length;
                const baseName = itemBases[baseIndex];
                
                let itemName = `${baseName} ${Math.floor(i / itemBases.length) > 0 ? 'Combo ' + Math.floor(i / itemBases.length) : ''} (${i})`;
                let price = (Math.random() * (15 - 5) + 5).toFixed(2);
                let description = `Delicious ${baseName.toLowerCase()} from ${restaurantName}. Made with fresh ingredients.`;

                if (restaurantName === 'Starbucks') {
                    const sbItems = ['Caramel Macchiato', 'Pumpkin Spice Latte', 'Double Shot Espresso', 'Cheese Danish', 'Iced Matcha Tea'];
                    itemName = sbItems[(i - 1) % sbItems.length] + ` (Size ${i % 3 === 0 ? 'L' : 'M'})`;
                    price = (Math.random() * (7 - 4) + 4).toFixed(2);
                } else if (restaurantName === 'McDonalds' && baseName === 'Burger') {
                    itemName = ['Big Mac', 'Quarter Pounder', 'McChicken', 'McFlurry'][baseIndex % 4];
                }

                items.push({
                    id: `${restaurantName.replace(/\s/g, '-')}-${i}`,
                    name: itemName.trim(),
                    description: description,
                    price: parseFloat(price),
                });
            }
            return items;
        };


        const initMenuPage = () => {
            const urlParams = new URLSearchParams(window.location.search);
            currentRestaurantName = urlParams.get('restaurant');
            
            const headerElement = document.getElementById('restaurantHeader');
            const menuContainer = document.getElementById('menuContainer');

            if (!currentRestaurantName) {
                headerElement.textContent = "Error: Restaurant Not Found";
                menuContainer.innerHTML = '<p class="text-center text-gray-500 mt-8">Please go back to the <a href="food.html" class="text-blue-600 font-semibold hover:underline">Restaurant List</a> and select a location.</p>';
                return;
            }

            const restaurant = ALL_RESTAURANTS.find(r => r.name === currentRestaurantName);
            const category = restaurant ? restaurant.category : 'General';
            restaurantColor = restaurant ? restaurant.color : '1e40af'; 

            headerElement.textContent = currentRestaurantName;
            document.title = `Menu: ${currentRestaurantName}`;
            headerElement.style.color = `#${restaurantColor}`;

            const menuItems = generateMenu(currentRestaurantName, category);
            
            menuContainer.innerHTML = '';
            menuItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card bg-white p-6 rounded-xl shadow-lg border-t-4 hover:border-blue-600 transition duration-300';
                card.style.borderColor = `#${restaurantColor}`;
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold text-gray-800">${item.name}</h3>
                        <span class="text-2xl font-extrabold text-blue-700">$${item.price.toFixed(2)}</span>
                    </div>
                    <p class="text-gray-500 mt-2 text-sm">${item.description}</p>
                    <button 
                        class="mt-4 w-full py-2 bg-blue-700 text-white font-semibold rounded-lg hover:bg-blue-800 transition duration-150"
                        onclick="addToCart('${item.id}', '${item.name}', ${item.price})"
                    >
                        Add to Cart
                    </button>
                `;
                menuContainer.appendChild(card);
            });
            
            updateCartUI(); // Initial UI update
        };

        document.addEventListener('DOMContentLoaded', initMenuPage);
    </script>
</head>
<body>
    <!-- Fixed Header -->
    <header class="main-header">
        <div class="flex items-center space-x-4">
            <a href="food.html" class="back-button text-white px-3 py-1 rounded-full text-sm bg-blue-700">
                &larr; Back to Restaurants
            </a>
            <a href="index.html" class="logo">TREKLEVO</a>
        </div>
        <div id="cartSummary" class="text-white">
            <!-- Cart Button and Summary injected here -->
        </div>
    </header>

    <!-- Page Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- Feedback Message Box -->
        <!-- Added opacity classes for smooth transition instead of instant hidden/show -->
        <div id="feedbackBox" class="hidden fixed top-20 right-4 p-3 bg-green-500 text-white rounded-lg shadow-xl z-50 transition duration-300 opacity-0">
            <!-- Message injected here -->
        </div>

        <!-- Restaurant Title -->
        <h1 id="restaurantHeader" class="text-4xl font-extrabold mb-8 text-center text-blue-700">
            Loading Menu...
        </h1>

        <!-- Menu Grid -->
        <div id="menuContainer" class="menu-grid">
            <!-- Menu items will be injected here -->
        </div>
    </main>
    
    <!-- Order Modal (Combines Cart, Payment, and Tracking) -->
    <div id="orderModal" class="order-modal fixed inset-0 hidden z-[100] flex items-center justify-center">
        <!-- Ensure modal uses full width on mobile devices -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto p-8 mx-4 sm:mx-0">
             <div id="modalContentContainer">
                 <!-- Cart, Payment, Matching, or Confirmed views injected here -->
             </div>
        </div>
    </div>

    <footer class="text-center py-4 text-gray-500 text-sm">
        <p>&copy; 2025 TREKLEVO, Inc. | Demo Checkout System</p>
    </footer>
</body>
</html>

