<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ride Booking App</title>
    <style>
        /* BASE STYLES */
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5; /* Light gray background */
            color: #1a1a1a;
        }
        .container {
            max-width: 480px; /* Slimmer, mobile-friendly container */
            margin: auto;
            background-color: #ffffff;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative; 
        }
        h1 {
            text-align: center;
            color: #1e88e5;
            margin-bottom: 24px;
            font-size: 2em;
            font-weight: 700;
        }
        h2 {
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 12px;
            color: #333;
        }

        /* INPUTS */
        .input-group {
            position: relative;
            margin-bottom: 15px;
        }
        .input-group input[type="text"] {
            width: 100%;
            padding: 14px 14px 14px 45px; /* Padding for icon */
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input-group input[type="text"]:focus {
            border-color: #1e88e5;
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
            outline: none;
        }
        .input-group .icon {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            color: #666;
            font-size: 18px;
        }

        /* MAP */
        .map-placeholder {
            width: 100%;
            height: 180px;
            background-color: #e8f5ee;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f0f0f0"/><line x1="0" y1="50" x2="100" y2="50" stroke="%23ccc" stroke-width="2"/><line x1="50" y1="0" x2="50" y2="100" stroke="%23ccc" stroke-width="2"/><circle cx="50" cy="50" r="10" fill="%23e53935"/></svg>');
            background-size: 100% 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border-radius: 10px;
            color: #333;
            font-weight: 600;
        }
        .map-large {
            height: 300px; 
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 20px;
        }
        .map-large p:first-child { margin-bottom: 5px; font-size: 1.1em; }
        .map-large p:last-child { font-size: 0.9em; color: #555; }

        /* CARDS (VEHICLE/PAYMENT) */
        .vehicle-options, .payment-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .vehicle-card, .payment-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .vehicle-card:hover, .payment-card:hover {
            border-color: #1e88e5;
            box-shadow: 0 2px 5px rgba(30, 136, 229, 0.1);
        }
        .vehicle-card.selected, .payment-card.selected {
            border-color: #1e88e5;
            background-color: #e3f2fd;
            box-shadow: 0 0 0 2px #90caf9;
        }
        .vehicle-info {
            display: flex;
            flex-direction: column;
        }
        .vehicle-name, .payment-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #1a1a1a;
        }
        .vehicle-price {
            font-size: 1.3em;
            font-weight: bold;
            color: #28a745;
        }
        .vehicle-eta {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 4px;
        }
        .payment-card .status {
            font-size: 0.8em;
            color: #6c757d;
        }
        .payment-card .status.confirmed {
            color: #4caf50;
            font-weight: 600;
        }

        /* BUTTONS */
        .book-button {
            width: 100%;
            padding: 16px;
            background-color: #1e88e5;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, opacity 0.3s;
            box-shadow: 0 4px 10px rgba(30, 136, 229, 0.3);
        }
        .book-button:hover:not(:disabled) {
            background-color: #1565c0;
        }
        .book-button:disabled {
            background-color: #90caf9;
            cursor: not-allowed;
            opacity: 0.8;
            box-shadow: none;
        }
        .button-secondary {
            padding: 10px 20px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        /* NOTIFICATION */
        #notification-banner {
            background-color: #4caf50; 
            border-radius: 0 0 8px 8px;
        }

        /* IN-RIDE VIEW */
        .ride-status-card {
            background-color: #f1f8e9; /* Lighter green background */
            border: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .status-message {
            font-size: 1.6em;
            color: #388e3c;
        }
        .driver-info {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
            margin: 20px 0;
            border-top: none;
            border-bottom: none;
        }
        .driver-info p {
            margin: 3px 0;
        }
        .driver-info strong {
            color: #1e88e5;
            font-weight: 600;
        }

        /* MODAL STYLES (MINOR ADJUSTMENTS) */
        .modal-content {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }
        .modal-confirm-button {
            background-color: #1e88e5;
        }
    </style>
</head>
<body>

<div class="container">
    <h1><span style="color: #28a745;">Go</span>Ride üöÄ</h1>
    
    <div id="notification-banner">
        üéâ Ride Accepted! Driver is confirmed and arriving soon.
    </div>

    <div id="booking-view">
        <div class="map-placeholder">
            <p>üó∫Ô∏è Live Map Integration</p>
        </div>

        <div class="input-group">
            <span class="icon">üìç</span>
            <input type="text" id="pickup-input" placeholder="Enter Pickup Location" oninput="checkBookingReadiness()">
        </div>
        <div class="input-group">
            <span class="icon">üèÅ</span>
            <input type="text" id="dropoff-input" placeholder="Enter Dropoff Location" oninput="checkBookingReadiness()">
        </div>

        <h2>Select Your Ride</h2>
        <div id="vehicle-options-container" class="vehicle-options" role="radiogroup">
            </div>

        <h2>Payment Method</h2>
        <div id="payment-options-container" class="payment-options" role="radiogroup">
            </div>

        <button id="book-ride-button" class="book-button" disabled onclick="bookRide()">
            Please enter locations, select a vehicle, and confirm your payment
        </button>
    </div>

    <div id="in-ride-view" style="display: none;">
        <div class="map-placeholder map-large">
            <p>üó∫Ô∏è **Live Ride Map**</p>
            <p>Driver is approaching. Estimated time: 3 minutes</p>
        </div>
        <div class="ride-status-card">
            <h2>Your Ride Status</h2>
            <div id="ride-status-message" class="status-message">Driver Confirmed!</div>

            <div class="driver-info">
                <div class="driver-photo-placeholder"></div>
                <div>
                    <p><strong>Driver:</strong> <span id="driver-name"></span></p>
                    <p><strong>Vehicle:</strong> <span id="vehicle-details"></span></p>
                    <p><strong>Rating:</strong> ‚≠êÔ∏è <span id="driver-rating">4.9</span></p>
                    <p><strong>Payment:</strong> <span id="payment-summary"></span></p>
                </div>
            </div>

            <div class="ride-summary">
                <p><strong>From:</strong> <span id="summary-pickup"></span></p>
                <p><strong>To:</strong> <span id="summary-dropoff"></span></p>
            </div>

            <button id="cancel-ride-btn" class="button-secondary" onclick="cancelRide()">Cancel Ride</button>
        </div>
    </div>
</div>

<div id="payment-modal-overlay" class="modal-overlay">
    <div id="payment-modal-content" class="modal-content">
        <span class="modal-close" onclick="closeModal(false)">&times;</span>
        <div class="modal-header">
            <h3 id="modal-title">Confirm Payment</h3>
        </div>
        
        <div id="modal-price-display" class="modal-price-display">
            $0.00 <span>(Estimated Ride Cost)</span>
        </div>

        <div id="modal-visa-form" style="display: none;">
            <input type="number" placeholder="Card Number (XXXX XXXX XXXX 1234)" required>
            <input type="text" placeholder="Card Holder Name" required>
            <div style="display: flex; gap: 10px;">
                <input type="text" placeholder="MM/YY" style="width: 50%;" required>
                <input type="number" placeholder="CVV" style="width: 50%;" required>
            </div>
        </div>

        <div id="modal-paypal-form" style="display: none;">
            <p style="text-align: center; color: #0070ba; font-weight: bold;">Log in to confirm payment</p>
            <input type="email" placeholder="Email or Phone Number" required>
            <input type="password" placeholder="Password" required>
        </div>

        <button class="modal-confirm-button" onclick="confirmPayment()">Confirm & Save</button>
    </div>
</div>
<script>
    // --- MOCK DATA ---
    const vehicles = [
        { id: 'standard', name: 'Standard üöó', price: 15.00, category: 'Standard', eta: '10 min' },
        { id: 'xl', name: 'XL üöå', price: 37.50, category: 'XL', eta: '10 min' },
        { id: 'premium', name: 'Premium üíé', price: 70.00, category: 'Premium', eta: '10 min' },
        { id: 'luxury', name: 'Luxury ‚ú®', price: 125.00, category: 'Luxury', eta: '10 min' },
        { id: 'heli_ride', name: 'Heli-Ride üöÅ', price: 450.00, category: 'Unique', eta: '5 min' },
        
        { id: 'airplane', name: 'Airplane ‚úàÔ∏è', price: 2500.00, category: 'Unique', eta: '1 hour' },
        { id: 'ice_cream', name: 'Ice Cream üç¶', price: 36.00, category: 'Fun', eta: '35 min (slow stops!)' },
        { id: 'garbage_truck', name: 'Garbage Truck üöö', price: 49.50, category: 'Fun', eta: '45 min (many stops!)' },
        { id: 'fire_truck', name: 'Fire Truck üöí', price: 150.00, category: 'Fun', eta: '15 min (with sirens)' },
        { id: 'exotic', name: 'Exotic Sportscar üèéÔ∏è', price: 187.50, category: 'Luxury', eta: '8 min (if traffic allows)' },
        
        { id: 'golf_cart', name: 'Golf Cart ‚õ≥', price: 8.00, category: 'Budget', eta: '15 min' },
        { id: 'walk', name: 'Walk üö∂', price: 2.50, category: 'Budget', eta: '40 min' },
        { id: 'bike', name: 'Bike üö≤', price: 5.60, category: 'Budget', eta: '20 min' }
    ];

    const paymentMethods = [
        // Added a 'display' name for confirmed methods
        { id: 'visa', name: 'Visa **** 1234', icon: 'üí≥', confirmed: false, confirmedName: 'Visa (default)' },
        { id: 'paypal', name: 'PayPal (Primary)', icon: 'üí∞', confirmed: false, confirmedName: 'PayPal Linked' },
        { id: 'cash', name: 'Cash', icon: 'üíµ', confirmed: true, confirmedName: 'Cash (pay driver)' } 
    ];
    // ----------------------------------------
    
    let selectedVehicleId = null;
    let selectedPaymentId = null;

    // --- DRIVER DETAILS LOGIC ---
    function getDriverDetails(vehicleId) {
        switch (vehicleId) {
            case 'standard':
            case 'xl':
                return { name: 'Sarah J.', rating: '4.9', plate: 'T-800' };
            case 'premium':
            case 'luxury':
                return { name: 'James B.', rating: '5.0', plate: 'L-007' };
            case 'heli_ride':
                return { name: 'Captain Viper', rating: '4.8', plate: 'H-911' };
            case 'airplane':
                return { name: 'Pilot Amelia', rating: '5.0', plate: 'F-14-J' };
            case 'ice_cream':
                return { name: 'Scoops M.', rating: '4.7', plate: 'I-C-3' };
            case 'garbage_truck':
                return { name: 'Refuse Rick', rating: '4.5', plate: 'G-ARB' };
            case 'fire_truck':
                return { name: 'Chief Blaze', rating: '4.9', plate: 'F-999' };
            case 'exotic':
                return { name: 'Racer Ken', rating: '4.9', plate: 'Z-010' };
            case 'golf_cart':
                return { name: 'Caddy Max', rating: '4.6', plate: 'G-OLF' };
            case 'walk':
                return { name: 'Speedy Sam', rating: '4.4', plate: 'N/A' };
            case 'bike':
                return { name: 'Wheels Willy', rating: '4.7', plate: 'B-ICY' };
            default:
                return { name: 'Driver D.', rating: '4.8', plate: 'X-777' };
        }
    }

    // --- VEHICLE SELECTION LOGIC ---
    function renderVehicles() {
        const container = document.getElementById('vehicle-options-container');
        container.innerHTML = ''; 

        vehicles.forEach(vehicle => {
            const isSelected = vehicle.id === selectedVehicleId;
            const card = document.createElement('div');
            card.className = `vehicle-card ${isSelected ? 'selected' : ''}`;
            card.setAttribute('data-id', vehicle.id);
            card.setAttribute('role', 'radio');
            card.setAttribute('aria-checked', isSelected ? 'true' : 'false');
            card.onclick = () => selectVehicle(vehicle.id);

            card.innerHTML = `
                <div class="vehicle-info">
                    <div class="vehicle-name">${vehicle.name}</div>
                    <div class="vehicle-eta">ETA: ${vehicle.eta}</div>
                </div>
                <div class="vehicle-price">$${vehicle.price.toFixed(2)}</div>
            `;
            container.appendChild(card);
        });
        checkBookingReadiness();
    }

    function selectVehicle(id) {
        selectedVehicleId = id;
        renderVehicles();
        // If an unconfirmed payment is selected, force modal check again for new price
        const selectedPayment = paymentMethods.find(p => p.id === selectedPaymentId);
        if (selectedPayment && !selectedPayment.confirmed && (selectedPayment.id === 'visa' || selectedPayment.id === 'paypal')) {
            openModal(selectedPayment.id);
        }
    }

    // --- PAYMENT SELECTION LOGIC ---

    function renderPaymentMethods() {
        const container = document.getElementById('payment-options-container');
        container.innerHTML = ''; 

        paymentMethods.forEach(method => {
            const isSelected = method.id === selectedPaymentId;
            const card = document.createElement('div');
            card.className = `payment-card ${isSelected ? 'selected' : ''}`; 
            card.setAttribute('data-id', method.id);
            card.setAttribute('role', 'radio');
            card.setAttribute('aria-checked', isSelected ? 'true' : 'false');
            card.onclick = () => selectPaymentMethod(method.id);

            const statusClass = method.confirmed ? 'confirmed' : '';
            const statusText = method.confirmed ? `‚úì ${method.confirmedName}` : 'Click to Add/Confirm';

            card.innerHTML = `
                <div class="payment-info">
                    <div class="payment-name">${method.icon} ${method.name}</div>
                </div>
                <div class="status ${statusClass}">${statusText}</div>
            `;
            container.appendChild(card);
        });
        checkBookingReadiness();
    }

    function selectPaymentMethod(id) {
        selectedPaymentId = id;

        const selectedMethod = paymentMethods.find(p => p.id === id);

        if (id === 'visa' || id === 'paypal') {
            if (!selectedMethod.confirmed) {
                openModal(id);
            }
        }
        
        renderPaymentMethods();
    }

    // --- MODAL LOGIC ---

    function openModal(type) {
        if (!selectedVehicleId) {
            alert('Please select a vehicle first to get the estimated price.');
            return;
        }

        const modalOverlay = document.getElementById('payment-modal-overlay');
        const modalTitle = document.getElementById('modal-title');
        const priceDisplay = document.getElementById('modal-price-display');
        const visaForm = document.getElementById('modal-visa-form');
        const paypalForm = document.getElementById('modal-paypal-form');

        const selectedVehicle = vehicles.find(v => v.id === selectedVehicleId);
        const price = selectedVehicle.price.toFixed(2);

        priceDisplay.innerHTML = `$${price} <span>(Estimated Ride Cost)</span>`;
        
        if (type === 'visa') {
            modalTitle.textContent = 'Enter Card Details';
            visaForm.style.display = 'block';
            paypalForm.style.display = 'none';
        } else if (type === 'paypal') {
            modalTitle.textContent = 'Log in to PayPal';
            visaForm.style.display = 'none';
            paypalForm.style.display = 'block';
        }

        modalOverlay.style.display = 'flex'; // Use flex for centering
    }

    function closeModal(wasConfirmed) {
        const modalOverlay = document.getElementById('payment-modal-overlay');
        modalOverlay.style.display = 'none';

        if (wasConfirmed && selectedPaymentId) {
            const index = paymentMethods.findIndex(p => p.id === selectedPaymentId);
            if (index !== -1) {
                paymentMethods[index].confirmed = true;
            }
        } else if (!wasConfirmed) {
            // If the modal was closed without confirming, deselect the payment method 
            // if it requires confirmation, so the user has to re-select it.
            if(selectedPaymentId !== 'cash') {
                selectedPaymentId = null;
            }
        }

        renderPaymentMethods(); 
    }

    function confirmPayment() {
        // Simple mock validation: Check if required inputs are not empty (for UX, not security)
        let formValid = true;
        const currentModal = document.querySelector(`#payment-modal-overlay input[type="email"], #payment-modal-overlay input[type="password"], #modal-visa-form input`);
        
        if (currentModal) {
            // A more rigorous validation would be here, but for now, we just proceed.
        }

        if (formValid) {
            closeModal(true); 
        } else {
            alert('Please fill out all mock fields.');
        }
    }


    // --- BOOKING LOGIC ---

    function checkBookingReadiness() {
        const pickup = document.getElementById('pickup-input').value;
        const dropoff = document.getElementById('dropoff-input').value;
        const button = document.getElementById('book-ride-button');

        const vehicleSelected = !!selectedVehicleId;
        
        const paymentMethod = paymentMethods.find(p => p.id === selectedPaymentId);
        const paymentConfirmed = paymentMethod ? paymentMethod.confirmed : false;

        const isReady = pickup && dropoff && vehicleSelected && paymentConfirmed;
        button.disabled = !isReady;

        if (isReady) {
            const selectedVehicle = vehicles.find(v => v.id === selectedVehicleId);
            const buttonName = selectedVehicle.name.split(' ')[0]; 
            button.textContent = `Book ${buttonName} for $${selectedVehicle.price.toFixed(2)}`;
        } else {
            button.textContent = 'Please enter locations, select a vehicle, and confirm your payment';
        }
    }

    function showNotification() {
        const banner = document.getElementById('notification-banner');
        banner.classList.add('show');
        
        setTimeout(() => {
            banner.classList.remove('show');
        }, 3000);
    }

    function bookRide() {
        const pickup = document.getElementById('pickup-input');
        const dropoff = document.getElementById('dropoff-input');
        const paymentMethod = paymentMethods.find(p => p.id === selectedPaymentId);

        if (pickup.value && dropoff.value && selectedVehicleId && paymentMethod && paymentMethod.confirmed) {
            
            showNotification();

            const selectedVehicle = vehicles.find(v => v.id === selectedVehicleId);
            const driverInfo = getDriverDetails(selectedVehicleId);
            
            setTimeout(() => {
                
                // --- Transition Views ---
                document.getElementById('booking-view').style.display = 'none';
                document.getElementById('in-ride-view').style.display = 'block';
                
                // --- Populate In-Ride View Details ---
                document.getElementById('driver-name').textContent = driverInfo.name;
                document.getElementById('driver-rating').textContent = driverInfo.rating;
                document.getElementById('vehicle-details').textContent = `${selectedVehicle.name.replace(/(\s\w+)$/, '')} ‚Ä¢ ${driverInfo.plate}`; 
                document.getElementById('payment-summary').textContent = `${paymentMethod.icon} ${paymentMethod.confirmedName}`; 
                document.getElementById('summary-pickup').textContent = pickup.value;
                document.getElementById('summary-dropoff').textContent = dropoff.value;

                // --- Start Ride Simulation ---
                simulateRide();

            }, 500); 

        } else {
            alert('Please ensure all fields are filled, a vehicle is selected, and your payment method is confirmed.');
        }
    }

    /**
     * Simulates the ride progression with realistic timing.
     */
    function simulateRide() {
        const statusElement = document.getElementById('ride-status-message');
        const mapPlaceholder = document.querySelector('#in-ride-view .map-placeholder p');
        
        const stages = [
            // Driver is confirmed and moving
            { message: 'Driver is arriving in 5 min.', mapText: 'Driver is approaching. Estimated time: 3 minutes', delay: 5000, color: '#ff9800' },
            // Driver arrives and waits for the user (3 minutes = 180,000ms)
            { message: 'Driver has arrived at pickup! You have 3 minutes to board.', mapText: 'Driver is at your location! Please head to the curb.', delay: 180000, color: '#2196f3' }, 
            // User boards and the ride starts
            { message: 'You are on the way to your destination.', mapText: 'On the road. Route progress: 60%', delay: 15000, color: '#1e88e5' },
            // Final arrival
            { message: 'You have arrived! Trip is complete.', mapText: 'Trip Complete. Thank you for riding!', delay: 5000, color: '#388e3c' }
        ];

        let currentStage = 0;

        function nextStage() {
            if (currentStage < stages.length) {
                const stage = stages[currentStage];
                statusElement.textContent = stage.message;
                statusElement.style.color = stage.color;
                mapPlaceholder.innerHTML = `üó∫Ô∏è **Live Ride Map**<br>${stage.mapText}`;

                currentStage++;
                setTimeout(nextStage, stage.delay);
            } else {
                // After the trip is complete, transition back to booking view after a delay
                setTimeout(() => {
                    alert('Your ride is complete! We hope you enjoyed it.');
                    // Reset confirmation status for payments
                    const visaIndex = paymentMethods.findIndex(p => p.id === 'visa');
                    if(visaIndex !== -1) paymentMethods[visaIndex].confirmed = false;
                    const paypalIndex = paymentMethods.findIndex(p => p.id === 'paypal');
                    if(paypalIndex !== -1) paymentMethods[paypalIndex].confirmed = false;

                    // Reset to booking view
                    document.getElementById('in-ride-view').style.display = 'none';
                    document.getElementById('booking-view').style.display = 'block';
                    
                    // Clear state
                    document.getElementById('pickup-input').value = '';
                    document.getElementById('dropoff-input').value = '';
                    selectedVehicleId = null;
                    selectedPaymentId = null; 
                    renderVehicles();
                    renderPaymentMethods();
                }, 5000);
            }
        }

        nextStage();
    }

    function cancelRide() {
        if(confirm('Are you sure you want to cancel your ride?')) {
            // Reset confirmation status for payments
            const visaIndex = paymentMethods.findIndex(p => p.id === 'visa');
            if(visaIndex !== -1) paymentMethods[visaIndex].confirmed = false;
            const paypalIndex = paymentMethods.findIndex(p => p.id === 'paypal');
            if(paypalIndex !== -1) paymentMethods[paypalIndex].confirmed = false;
            
            // Reset to booking view
            document.getElementById('in-ride-view').style.display = 'none';
            document.getElementById('booking-view').style.display = 'block';
            
            // Clear state
            document.getElementById('pickup-input').value = '';
            document.getElementById('dropoff-input').value = '';
            selectedVehicleId = null;
            selectedPaymentId = null;
            renderVehicles();
            renderPaymentMethods();
            alert('Your ride has been cancelled.');
        }
    }

    // Initialize all options when the page loads
    window.onload = () => {
        // Start with a default vehicle and payment selection to make the process easier to test
        selectedVehicleId = vehicles[0].id;
        selectedPaymentId = paymentMethods[2].id; // Default to Cash, which is confirmed
        
        renderVehicles();
        renderPaymentMethods();
    };
</script>

</body>
</html>