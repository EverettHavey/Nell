<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NELL Rides</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general layout */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            min-height: 100vh;
        }

        /* Utility class to prevent body scrolling when mobile menu is open */
        .overflow-hidden {
            overflow: hidden;
        }

        .main-header {
            background-color: #1f2937; /* Dark gray */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fcd34d; /* Amber-300 */
            text-decoration: none;
        }
        
        .ride-option-card {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .ride-option-card.selected {
            border-color: #1e40af; /* Blue-700 */
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.3);
            background-color: #eff6ff; /* Blue-50 */
        }
        
        /* Spinner for driver matching */
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #1e40af; 
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Payment selection styles */
        .payment-option-card-ride {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .payment-option-card-ride.selected {
            border-color: #1e40af; 
            background-color: #eff6ff;
        }
    </style>
    
    <script>
        // --- GLOBAL STATE ---
        let appState = 'request'; // 'request', 'confirm', 'finding', 'complete'
        let rideDetails = {
            pickup: '', 
            dropoff: '', 
            type: '', // No default ride type selected
            price: 0,
            distance: 5.5, // simulated distance in miles
            duration: 15, // simulated duration in minutes
        };
        let driver = null;
        let selectedPaymentMethod = ''; // No default payment method selected
        let isMenuOpen = false; // Mobile menu state
        
        const RIDE_TYPES = [
            { name: 'Standard', description: 'Affordable, everyday rides (2-4 passengers)', icon: 'üßç', multiplier: 1.0, minFare: 5.00 },
            { name: 'Premium', description: 'Luxury sedans, top rated drivers (2-4 passengers)', icon: 'üíé', multiplier: 1.5, minFare: 8.00 },
            { name: 'SUV', description: 'Extra room for groups (4-6 passengers)', icon: 'üöê', multiplier: 1.8, minFare: 10.00 },
            // Wheelchair Accessible option
            { name: 'Accessible', description: 'Wheelchair-accessible vehicle (1-4 passengers)', icon: '‚ôø', multiplier: 1.2, minFare: 6.50 },
            { name: 'Share Standard', description: 'Shared ride for one passenger to a similar destination (1-6 passengers)', icon: 'ü´Ç', multiplier: 0.7, minFare: 3.50 }
        ];
        
        const DRIVERS = [
            { name: 'Alex Johnson', car: 'Honda Civic', license: 'XYZ-789', rating: 4.85 },
            { name: 'Maria Rodriguez', car: 'Toyota Camry', license: 'ABC-123', rating: 4.92 },
            { name: 'David Lee', car: 'Tesla Model 3', license: 'TES-420', rating: 4.79 },
            { name: 'Jasmine Chen', car: 'Nissan Rogue', license: 'RGE-901', rating: 4.68 },
        ];

        // --- CORE FUNCTIONS ---
        
        const toggleMobileMenu = () => {
            const menu = document.getElementById('mobile-menu');
            isMenuOpen = !isMenuOpen;
            
            if (isMenuOpen) {
                // Show menu: slide in from left and prevent body scroll
                menu.classList.remove('-translate-x-full');
                menu.innerHTML = renderMobileMenuContent();
                document.body.classList.add('overflow-hidden'); 
            } else {
                // Hide menu: slide out to left and allow body scroll
                menu.classList.add('-translate-x-full');
                document.body.classList.remove('overflow-hidden');
            }
        };

        const renderMobileMenuContent = () => {
            const navLinks = [
                { href: 'index.html', label: 'Home' },
                { href: 'services.html', label: 'Services' },
                { href: 'city.html', label: 'Cities' },
                { href: 'food.html', label: 'Order Food' },
                { href: 'aboutus.html', label: 'About Us' },
                { href: 'support.html', label: 'Support' },
                { href: 'career.html', label: 'Careers' },
            ];
            
            // Mobile menu content with close button (X)
            return `
                <div class="flex justify-between items-center p-4 h-16 bg-gray-900 border-b border-gray-700">
                    <a href="index.html" class="logo text-white">NELL Rides</a>
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-amber-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <ul class="flex flex-col space-y-2 p-4 text-xl font-bold">
                    ${navLinks.map(link => `
                        <li><a href="${link.href}" onclick="toggleMobileMenu()" class="text-gray-300 hover:bg-gray-700 hover:text-amber-300 transition duration-150 block p-3 rounded-lg">${link.label}</a></li>
                    `).join('')}
                </ul>
            `;
        };

        const calculatePrice = () => {
            const baseRate = 2.00;
            const perMile = 1.80;
            const type = RIDE_TYPES.find(t => t.name === rideDetails.type);
            
            // If no ride type is selected, set price to 0 and exit
            if (!type) {
                rideDetails.price = 0;
                return;
            }

            const rawFare = baseRate + (rideDetails.distance * perMile * type.multiplier);
            const finalFare = Math.max(rawFare, type.minFare);
            
            rideDetails.price = parseFloat(finalFare.toFixed(2));
        };

        const updateState = (newState) => {
            appState = newState;
            renderApp();
        };

        const selectRideType = (type) => {
            rideDetails.type = type;
            calculatePrice();
            renderApp();
        };
        
        const selectPaymentMethod = (method) => {
            selectedPaymentMethod = method;
            const creditOption = document.getElementById('creditRideOption');
            const cashOption = document.getElementById('cashRideOption');
            const ccForm = document.getElementById('creditCardForm');
            
            // Only attempt to update classes if the elements exist (i.e., we are in the 'confirm' view)
            if (creditOption && cashOption) {
                // Remove 'selected' class from all options
                document.querySelectorAll('.payment-option-card-ride').forEach(el => el.classList.remove('selected'));
                
                // Add 'selected' class only to the currently selected option, if one is selected
                if (method) {
                    document.getElementById(`${method}RideOption`).classList.add('selected');
                }
            }

            // Toggle Credit Card Form Visibility
            if (ccForm) {
                ccForm.style.display = method === 'credit' ? 'block' : 'none';
            }
        };

        const requestRide = () => {
            const pickup = rideDetails.pickup.trim();
            const dropoff = rideDetails.dropoff.trim();
            
            // 1. Determine error message based on validation state
            let errorMessage = '';
            if (!pickup || !dropoff) {
                errorMessage = '‚ö†Ô∏è Please Enter Pickup and Dropoff Locations';
            } else if (!rideDetails.type) {
                errorMessage = '‚ö†Ô∏è Please Select a Ride Type';
            }
            
            if (errorMessage) {
                console.warn(errorMessage);
                
                const requestButton = document.querySelector('button[onclick="requestRide()"]');
                if (requestButton) {
                    const originalText = requestButton.textContent;
                    const originalClass = requestButton.className;
                    
                    // Display error on button
                    requestButton.textContent = errorMessage;
                    requestButton.className = 'w-full py-4 text-white font-extrabold rounded-xl transition duration-150 bg-red-600 hover:bg-red-700';
                    
                    // Restore button after delay
                    setTimeout(() => {
                        // The button text must dynamically check the ride type again, as its previous text was dynamic
                        const currentType = rideDetails.type;
                        requestButton.textContent = currentType ? `Request ${currentType}` : 'Select a Ride Type to Continue';
                        requestButton.className = 'w-full py-4 bg-blue-700 text-white font-extrabold rounded-xl hover:bg-blue-800 transition duration-150 ' + (currentType ? '' : 'opacity-60 cursor-not-allowed');
                    }, 2000); 
                }
                return;
            }
            
            // If all checks pass
            updateState('confirm');
        };

        const confirmBooking = () => {
            // 1. Check if any payment method is selected
            if (!selectedPaymentMethod) {
                console.error('Validation failed: Please select a payment method.');
                
                const confirmButton = document.querySelector('button[onclick="confirmBooking()"]');
                if (confirmButton) {
                    const originalText = confirmButton.textContent;
                    const originalClass = confirmButton.className;
                    
                    confirmButton.textContent = '‚ö†Ô∏è Please Select a Payment Method!';
                    confirmButton.className = 'w-full py-4 text-white font-extrabold rounded-xl transition duration-150 bg-red-600 hover:bg-red-700 mt-6';
                    
                    setTimeout(() => {
                        confirmButton.textContent = originalText;
                        confirmButton.className = originalClass; // Restore original classes
                    }, 2000);
                }
                return;
            }
            
            // 2. If 'credit' is selected, check card details
            if (selectedPaymentMethod === 'credit') {
                const ccNumber = document.getElementById('ccNumber')?.value;
                const ccExpiry = document.getElementById('ccExpiry')?.value;
                const ccCvv = document.getElementById('ccCvv')?.value;

                // Basic validation check for credit card details
                if (!ccNumber || ccNumber.length < 16 || !ccExpiry || ccExpiry.length < 5 || !ccCvv || ccCvv.length < 3) {
                    console.error('Validation failed: Please enter valid credit card details.');
                    
                    const confirmButton = document.querySelector('button[onclick="confirmBooking()"]');
                    if (confirmButton) {
                        const originalText = confirmButton.textContent;
                        const originalClass = confirmButton.className;
                        
                        confirmButton.textContent = '‚ö†Ô∏è Fill out card details!';
                        confirmButton.className = 'w-full py-4 text-white font-extrabold rounded-xl transition duration-150 bg-red-600 hover:bg-red-700 mt-6';
                        
                        setTimeout(() => {
                            confirmButton.textContent = originalText;
                            confirmButton.className = originalClass; // Restore original classes
                        }, 2000);
                    }
                    return;
                }
            }

            updateState('finding');
            
            // Simulate driver matching time
            setTimeout(() => {
                driver = DRIVERS[Math.floor(Math.random() * DRIVERS.length)];
                updateState('complete');
            }, 3000); // 3 second delay
        };
        
        // --- RENDER FUNCTIONS ---

        const renderRequestView = (container) => {
            container.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Where to?</h2>
                    
                    <!-- Location Inputs -->
                    <div class="space-y-4">
                        <div class="p-3 bg-white rounded-xl shadow-md flex items-center space-x-3 border-l-4 border-amber-300">
                            <span class="text-lg">üìç</span>
                            <input type="text" id="pickup" value="${rideDetails.pickup}" class="flex-grow border-none focus:ring-0 p-0 text-gray-700 font-semibold" onchange="rideDetails.pickup = this.value" placeholder="Enter pickup location">
                        </div>
                        <div class="p-3 bg-white rounded-xl shadow-md flex items-center space-x-3 border-l-4 border-blue-700">
                            <span class="text-lg">üèÅ</span>
                            <input type="text" id="dropoff" value="${rideDetails.dropoff}" class="flex-grow border-none focus:ring-0 p-0 text-gray-700 font-semibold" onchange="rideDetails.dropoff = this.value" placeholder="Enter destination">
                        </div>
                    </div>

                    <!-- Ride Type Selection -->
                    <div class="pt-4">
                        <h3 class="text-xl font-semibold mb-3 text-gray-700">Select Your Ride</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${RIDE_TYPES.map(type => `
                                <div onclick="selectRideType('${type.name}')" 
                                    class="ride-option-card bg-white p-4 rounded-xl shadow-md text-center ${rideDetails.type === type.name ? 'selected' : ''}">
                                    <span class="text-3xl">${type.icon}</span>
                                    <p class="font-bold mt-1 text-gray-800">${type.name}</p>
                                    <p class="text-xs text-gray-500">${type.description}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Price Summary & Button -->
                    <div class="pt-4 border-t">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-semibold">Estimated Fare:</span>
                            <span class="text-3xl font-extrabold text-blue-700">$${rideDetails.price.toFixed(2)}</span>
                        </div>
                        <button onclick="requestRide()" class="w-full py-4 bg-blue-700 text-white font-extrabold rounded-xl hover:bg-blue-800 transition duration-150 ${rideDetails.type ? '' : 'opacity-60 cursor-not-allowed'}">
                            ${rideDetails.type ? `Request ${rideDetails.type}` : 'Select a Ride Type to Continue'}
                        </button>
                    </div>
                </div>
            `;
        };

        const renderConfirmView = (container) => {
            container.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Confirm & Pay</h2>

                    <!-- Ride Summary -->
                    <div class="p-4 bg-white rounded-xl shadow-lg space-y-2">
                        <p class="text-xl font-bold text-gray-800">${rideDetails.type} Ride</p>
                        <div class="text-gray-600">
                            <p>From: <span class="font-semibold">${rideDetails.pickup || '‚Äî'}</span></p>
                            <p>To: <span class="font-semibold">${rideDetails.dropoff || '‚Äî'}</span></p>
                            <p>Est. Time: ${rideDetails.duration} min | Est. Distance: ${rideDetails.distance} miles</p>
                        </div>
                        <div class="text-3xl font-extrabold text-blue-700 pt-2 border-t mt-3">Total: $${rideDetails.price.toFixed(2)}</div>
                    </div>
                    
                    <!-- Payment Selection -->
                    <h3 class="text-xl font-semibold mt-6 text-gray-700">Choose Payment</h3>
                    <div class="space-y-3">
                        <div id="creditRideOption" onclick="selectPaymentMethod('credit')" class="payment-option-card-ride p-4 rounded-xl bg-white shadow-sm border-2 border-gray-300 ${selectedPaymentMethod === 'credit' ? 'selected' : ''}">
                            <div class="flex items-center space-x-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" viewBox="0 0 20 20" fill="currentColor"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" /><path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 110-2 1 1 0 010 2zm10-1a1 1 0 100 2h1a1 1 0 100-2h-1z" clip-rule="evenodd" /></svg>
                                <p class="font-semibold text-lg">Credit/Debit Card</p>
                            </div>
                        </div>

                        <!-- Credit Card Input Form -->
                        <div id="creditCardForm" class="p-4 bg-gray-50 rounded-lg shadow-inner space-y-3 transition duration-300 ease-in-out" style="${selectedPaymentMethod === 'credit' ? 'display: block;' : 'display: none;'}">
                            <h4 class="text-sm font-bold text-gray-600">Enter Payment Details</h4>
                            <input type="text" id="ccNumber" placeholder="Card Number (XXXX XXXX XXXX XXXX)" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" maxlength="19">
                            <div class="flex space-x-3">
                                <input type="text" id="ccExpiry" placeholder="MM/YY" class="w-1/2 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" maxlength="5">
                                <input type="text" id="ccCvv" placeholder="CVV" class="w-1/2 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" maxlength="4">
                            </div>
                        </div>
                        
                        <div id="cashRideOption" onclick="selectPaymentMethod('cash')" class="payment-option-card-ride p-4 rounded-xl bg-white shadow-sm border-2 border-gray-300 ${selectedPaymentMethod === 'cash' ? 'selected' : ''}">
                            <div class="flex items-center space-x-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1h4a1 1 0 011 1v5a1 1 0 01-1 1h-.828l1.768 1.768A1 1 0 0114 15h-4.172l.939-.939A7.001 7.001 0 0013 4a1 1 0 112 0 5.001 5.001 0 01-5 5H4a1 1 0 110-2h6V2zm-2 9a1 1 0 100 2h4a1 1 0 100-2H8z" clip-rule="evenodd" /></svg>
                                <p class="font-semibold text-lg">Cash to Driver</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Confirm Button -->
                    <button onclick="confirmBooking()" class="w-full py-4 bg-amber-300 text-gray-800 font-extrabold rounded-xl hover:bg-amber-400 transition duration-150 mt-6">
                        Confirm Ride & Find Driver
                    </button>
                    <button onclick="updateState('request')" class="w-full py-2 text-blue-700 font-semibold rounded-lg hover:underline transition duration-150">
                        Edit Ride Details
                    </button>
                </div>
            `;
            // Note: The selectPaymentMethod call here is technically redundant since we inline the classes now, 
            // but keeping it ensures the CC form visibility is set correctly if selectedPaymentMethod had a value.
            selectPaymentMethod(selectedPaymentMethod); 
        };

        const renderFindingView = (container) => {
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-center py-20 space-y-6">
                    <div class="spinner"></div>
                    <h2 class="text-3xl font-bold text-gray-800">Finding your driver...</h2>
                    <p class="text-gray-500">Please wait, we are matching you with the nearest ${rideDetails.type} driver.</p>
                </div>
            `;
        };

        const renderCompleteView = (container) => {
            if (!driver) return; // Should not happen
            container.innerHTML = `
                <div class="space-y-6 text-center">
                    <div class="text-6xl mb-4">‚úÖ</div>
                    <h2 class="text-3xl font-bold text-green-600">Driver Found!</h2>
                    <p class="text-xl text-gray-700">Your ${rideDetails.type} is on the way.</p>

                    <!-- Driver Card -->
                    <div class="p-6 bg-white rounded-xl shadow-lg border-t-4 border-green-500 mx-auto max-w-sm">
                        <p class="text-2xl font-extrabold text-blue-700">${driver.name}</p>
                        <p class="text-gray-600">${driver.car} (${driver.license})</p>
                        <p class="text-amber-500 font-bold mt-2">${driver.rating} &#9733; Rating</p>
                        <div class="mt-4 pt-3 border-t">
                             <p class="font-semibold text-lg">Fare: $${rideDetails.price.toFixed(2)}</p>
                             <p class="text-sm text-gray-500">Payment: ${selectedPaymentMethod === 'cash' ? 'Cash to Driver' : 'Card on File'}</p>
                        </div>
                    </div>

                    <button onclick="window.location.reload()" class="w-full max-w-xs py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition duration-150 mt-8">
                        Start New Ride
                    </button>
                </div>
            `;
        };

        const renderApp = () => {
            const mainContent = document.getElementById('rideAppContent');
            if (!mainContent) return;

            // Clear previous content
            mainContent.innerHTML = ''; 

            switch (appState) {
                case 'request':
                    renderRequestView(mainContent);
                    break;
                case 'confirm':
                    renderConfirmView(mainContent);
                    break;
                case 'finding':
                    renderFindingView(mainContent);
                    break;
                case 'complete':
                    renderCompleteView(mainContent);
                    break;
                default:
                    renderRequestView(mainContent);
            }
        };

        // Initialize App on load
        document.addEventListener('DOMContentLoaded', () => {
            calculatePrice(); // Initial price calculation
            renderApp();
        });
    </script>
</head>
<body class="flex flex-col">
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-gray-900 bg-opacity-95 z-40 transform -translate-x-full transition-transform duration-300 md:hidden">
        <!-- Content injected by JS renderMobileMenuContent() -->
    </div>
    
    <header class="main-header p-4 flex justify-between items-center text-white z-50">
        <a href="index.html" class="logo">NELL Rides</a>
        
        <!-- Desktop Navigation Links (Visible on MD screens and up) -->
        <nav class="hidden md:block">
            <ul class="flex space-x-6 text-sm font-medium">
                <li><a href="index.html" class="text-gray-300 hover:text-amber-300 transition duration-150">Home</a></li> 
                <li><a href="services.html" class="text-gray-300 hover:text-amber-300 transition duration-150">Services</a></li>
                <li><a href="city.html" class="text-gray-300 hover:text-amber-300 transition duration-150">Cities</a></li>
                <li><a href="food.html" class="text-gray-300 hover:text-amber-300 transition duration-150">Order Food</a></li>
                <li><a href="aboutus.html" class="text-gray-300 hover:text-amber-300 transition duration-150">About Us</a></li>
                <li><a href="support.html" class="text-gray-300 hover:text-amber-300 transition duration-150">Support</a></li>
                <li><a href="career.html" class="text-gray-300 hover:text-amber-300 transition duration-150">Careers</a></li>
            </ul>
        </nav>

        <!-- Mobile Menu Button (Hidden on MD screens and up) -->
        <button id="menu-button" class="md:hidden p-1 text-gray-300 hover:text-amber-300" onclick="toggleMobileMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" />
            </svg>
        </button>
    </header>

    <main class="container mx-auto px-4 py-8 flex-grow">
        <!-- The max-w-3xl ensures the content container doesn't get too wide on large screens, while px-4 provides necessary padding on mobile. -->
        <div class="max-w-3xl mx-auto bg-white p-6 sm:p-8 rounded-2xl shadow-2xl">
            <div id="rideAppContent">
                <!-- Content injected by JavaScript -->
            </div>
        </div>
    </main>

    <footer class="text-center py-4 text-gray-500 text-sm">
        <p>&copy; 2025 NELL, Inc. | Ride Service Simulation</p>
    </footer>
</body>
</html>
